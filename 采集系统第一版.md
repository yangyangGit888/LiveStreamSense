## é‡‡é›†ç³»ç»Ÿè®¾è®¡

### 1ã€ç›´æ’­é—´ç›¸å…³è¯·æ±‚

#### 1.ç›´æ’­é—´è§‚ä¼—è´¡çŒ®æ¦œ

**==æœ€å€¼é’±ç”¨æˆ·åå•==**

**ç”¨æ¥è¿”å›å½“å‰ç›´æ’­é—´â€œæœ€æœ‰ä»·å€¼è§‚ä¼—â€çš„åˆ—è¡¨**

å…·ä½“æ˜¯ï¼š

- ç¤¼ç‰©æ¦œ / æ´»è·ƒæ¦œ / è´¡çŒ®æ¦œï¼ˆç”± `rank_type` æ§åˆ¶ï¼‰
- **ä¸æ˜¯å…¨é‡è§‚ä¼—**
- **åªè¿”å›â€œå¯¹ä¸»æ’­æœ‰ä»·å€¼çš„äººâ€**

https://xxx.com/webcast/ranklist/audience	

æ¥å£è¯·æ±‚ä¸­æ ¸å¿ƒå‚æ•°

```
å‚æ•°				è¯´æ˜
room_id			ç›´æ’­é—´å”¯ä¸€IDï¼ˆæœ€å…³é”®ï¼‰
anchor_id		ä¸»æ’­ID
sec_anchor_id	ä¸»æ’­å®‰å…¨ID
rank_type=30	æ¦œå•ç±»å‹ï¼ˆéå¸¸é‡è¦ï¼‰ï¼ŒæŒ‡çš„æ˜¯ç›´æ’­é—´è§‚ä¼—è´¡çŒ®æ¦œ / è£èª‰æ¦œï¼ˆé«˜ç­‰çº§ / é«˜ä»˜è´¹ / é«˜æ´»è·ƒï¼‰

```

**rank_type æ€»è§ˆ**

> **rank_type å†³å®šï¼šæ¦œå•æ€ä¹ˆç®—ã€å“ªäº›äººä¼šä¸Šæ¦œã€åˆ†æ•°ä»£è¡¨ä»€ä¹ˆ**

| rank_type | æ¦œå•ç±»å‹ï¼ˆå®æˆ˜ç†è§£ï¼‰  | æ ¸å¿ƒä»·å€¼         |
| --------- | --------------------- | ---------------- |
| 30        | ğŸ† è§‚ä¼—è´¡çŒ®æ¦œ / è£èª‰æ¦œ | **åœŸè±ª / é“ç²‰**  |
| 31        | ğŸ ç¤¼ç‰©æ¦œï¼ˆå‘¨æœŸï¼‰      | çŸ­æœŸçˆ†å‘å‹ç”¨æˆ·   |
| 32        | ğŸ”¥ æ´»è·ƒæ¦œ              | é«˜äº’åŠ¨ç”¨æˆ·       |
| 33        | â± è¿ç»­è´¡çŒ®æ¦œ          | æŒç»­ä»˜è´¹ç”¨æˆ·     |
| 34        | ğŸ’ é«˜ç­‰çº§æ¦œ            | é•¿æœŸé«˜å‡€å€¼ç”¨æˆ·   |
| 35        | ğŸ§± ç²‰ä¸å›¢æ¦œ            | ä¸»æ’­ç§åŸŸæ ¸å¿ƒ     |
| 36        | ğŸ•µï¸ æ–°è´µæ¦œ              | æ–°å‡ºç°çš„æ½œåŠ›ç”¨æˆ· |

**å“åº”å€¼æ ¸å¿ƒå­—æ®µåˆ†æ**

**ç”¨æˆ·å”¯ä¸€è¯†åˆ«**

```
"id": 84878213586  // æŠ–éŸ³å”¯ä¸€ç”¨æˆ·ID,ä¸»é”®ï¼Œç”¨ä½œå†…éƒ¨æ•°æ®åº“ä¸»é”®
"id_str": "84878213586"
"sec_uid": "MS4wLjABAAAADgOgsr8..." // å”¯ä¸€ç”¨æˆ·ID,ä¸»é”®ï¼Œç”¨äºAPIè°ƒç”¨ï¼Œä¸idç”¨é€”ä¸åŒ
"webcast_uid": "MS4wLjPpqfy_..." // ç½‘ç»œå¹¿æ’­uid
"display_id": "194138010"  // ç”¨æˆ·ä¸»é¡µæŠ–éŸ³å·
 nickname  // ç”¨æˆ·åç§°
```

 **ä»˜è´¹èƒ½åŠ›**

```
"pay_grade": {
  "level": 38, // è¶…é«˜ç­‰çº§ä»˜è´¹ç”¨æˆ·
  "this_grade_min_diamond": 500000,// è‡³å°‘æ¶ˆè´¹é’»çŸ³æ•°é‡
  "this_grade_max_diamond": 620000,// æœ€é«˜æ¶ˆè´¹é’»çŸ³ä¸Šé™ï¼Œæ¶ˆè´¹è¶…è¿‡620000å°±å›åˆ°39çº§
  "buff_info": {		// ä»˜è´¹BUFFï¼ˆè¿é€ã€åŠ æˆï¼‰
    "buff_level": 201,
    "end_time": 1753600182
  }
}
```

**ç²‰ä¸å›¢å…³ç³»ï¼ˆæ˜¯å¦æ˜¯â€œè‡ªå·±äººâ€ï¼‰**

```
"fans_club": {
  "data": {
    "level": 16, //ç²‰ä¸å›¢ç­‰çº§
    "user_fans_club_status": 1,// å·²åŠ å…¥ç²‰ä¸å›¢
    "anchor_id": 76055758243 // å½’å±ä¸»æ’­ID
  }
}
```

**æ’å & è´¡çŒ®åº¦**

```
"rank": 1 //å½“å‰æ¦œå•ç¬¬å‡ ï¼Œé‡è¦
"score": 1 //æ¦œå•ç§¯åˆ†ï¼ˆä¸åŒæ¦œæ„ä¹‰ä¸åŒï¼‰ä¸é‡è¦
"delta": 0 //æ’åå˜åŒ–ï¼ˆâ†‘â†“ï¼‰
```

**æ˜¯å¦åŒ¿å / é©¬ç”²åˆ¤æ–­**

```
"mystery_man": 1 //éšèº«
"is_anonymous": false // ä¸åŒ¿å
```

#### 2.ç›´æ’­é—´ç¤¼ç‰©é…ç½®

 **å½“å‰è¿™ä¸ªç›´æ’­é—´â€œèƒ½é€ä»€ä¹ˆç¤¼ç‰©ã€æ¯ä¸ªç¤¼ç‰©å¤šå°‘é’±ã€æœ‰æ²¡æœ‰ç²‰ä¸å›¢/ç‰¹æƒé™åˆ¶â€**

"https://live.douyin.com/webcast/gift/list/â€œ

è¿”å›å€¼**åˆ†æ**

```
gift_id 			// ç¤¼ç‰©çš„å”¯ä¸€ID
diamond_count		// è¿™ä¸ªç¤¼ç‰©å¤šå°‘é’»çŸ³ï¼Œç»Ÿä¸€è®¡ä»·å•ä½
"fansclub_gift_ids": [6309, 860, ...]		// åªæœ‰ä¸»æ’­ç²‰ä¸å›¢æ‰èƒ½é€çš„ç¤¼ç‰©ï¼Œåˆ—è¡¨æ˜¯ç¤¼ç‰©ID
"is_fansclub": true,	// æ˜¯å¦ç²‰ä¸å›¢ç¤¼ç‰©
"type": 1				// æ™®é€š / ç‰¹æ•ˆ / è¿å‡»
"new_gift_id": 0		// æ–°ä¸Šçº¿ç¤¼ç‰©
```



#### 3.wssç›´æ’­é—´ä¸» IM é€šé“ï¼ˆæ ¸å¿ƒï¼‰

```
v2/?app_name=douyin_web
&version_code=180800
&webcastâ€¦
&heartbeatDuration=0
&signature=6BDXc0uX0UKDLKdc
```

**90% æ•°æ®éƒ½åœ¨è¿™é‡Œ**

åŒ…æ‹¬ï¼š

| è¡Œä¸º     | æ˜¯å¦å­˜åœ¨ |
| -------- | -------- |
| è¿›åœºæ¶ˆæ¯ | âœ…        |
| å¼¹å¹•     | âœ…        |
| ç‚¹èµ     | âœ…        |
| ç¤¼ç‰©     | âœ…        |
| å…³æ³¨     | âœ…        |
| æ¦œå•æ¨é€ | âœ…        |

ä½ åœ¨è¿™ä¸ª wss çš„ **Frames â†’ Response** é‡Œï¼Œä¸€å®šèƒ½çœ‹åˆ°ï¼š

- **äºŒè¿›åˆ¶å¸§**
- **protobuf** / **gzip**
- message_type / method / payload

**ç¨‹åºä¸­æ•è·wssè¿”å›å€¼æ•°æ®çš„æ˜¯é€šè¿‡äºŒè¿›åˆ¶è¿”å›ç»™ç¨‹åºä¸­ï¼Œé€šè¿‡å­—èŠ‚æ•°ç»„æ¥æ¥å—ã€‚**









### 2ã€æœ€å°é‡‡é›†æ–¹æ¡ˆ

#### 1.æ–¹æ¡ˆè®¾è®¡

```
â‘  web-enterï¼ˆæ‹¿ room_idï¼‰
â‘¡ gift-listï¼ˆä»·æ ¼è¡¨ï¼‰
â‘¢ WebSocket IMï¼ˆåªè§£æ 5 ç§æ¶ˆæ¯ï¼‰ï¼š
è¿›åœº	MemberMessage
å¼¹å¹•	ChatMessage
ç‚¹èµ	LikeMessage
é€ç¤¼	GiftMessage
å…³æ³¨	SocialMessage

```



#### 2.wss IM æ¶ˆæ¯ã€å®Œæ•´è§£åŒ…æµç¨‹å›¾ã€‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WebSocket onMessage(bytes)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
      [Step 1] åˆ¤ç©º & é•¿åº¦æ ¡éªŒ
               â”‚
               â–¼
      [Step 2] è§£æã€Œå¤–å±‚ Response protobufã€
               â”‚
               â”‚  (æ³¨æ„ï¼šä¸æ˜¯ gzip)
               â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Response                     â”‚
      â”‚  â”œâ”€ messages[]              â”‚
      â”‚  â”œâ”€ needAck                 â”‚
      â”‚  â””â”€ internalExt / cursor    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        for message in messages[]
                     â”‚
                     â–¼
      [Step 3] åˆ¤æ–­ message.payload
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚
       â–¼                 â–¼
   æ—  payload         æœ‰ payload
   (å¿ƒè·³/ACK)           â”‚
       â”‚                â–¼
       â”‚        [Step 4] gzip è§£å‹
       â”‚                â”‚
       â”‚                â–¼
       â”‚     [Step 5] è§£æã€Œå†…å±‚ protobufã€
       â”‚                â”‚
       â”‚                â–¼
       â”‚      [Step 6] æ ¹æ® method åˆ†å‘
       â”‚                â”‚
       â”‚     Chat / Gift / Member
       â–¼
   ç›´æ¥ä¸¢å¼ƒ

```

#### 3.IMæ¶ˆæ¯ä¸­ protobuf çš„ã€ŒçœŸå®ç»“æ„ã€

```
message Response {
  repeated Message messages = 1;
  string cursor = 2;
  string internalExt = 3;
  bool needAck = 4;
}

message Message {
  string method = 1;      // å…³é”®
  bytes payload = 2;     // å…³é”®ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰
  int64 msgId = 3;
  int64 timestamp = 4;
}

```

**çœŸæ­£å…³å¿ƒçš„åªæœ‰ä¸¤ä¸ªå­—æ®µï¼š**

| å­—æ®µ      | ä½œç”¨                           |
| --------- | ------------------------------ |
| `method`  | å†³å®šè¿™æ¡æ¶ˆæ¯æ˜¯ä»€ä¹ˆç±»å‹         |
| `payload` | gzip + protobuf çš„çœŸæ­£ä¸šåŠ¡æ•°æ® |

#### 4.ç¨‹åºç®€è¦å®ç°æ­¥éª¤ä¸æ³¨æ„ç‚¹

Step 0ï¸âƒ£ WebSocket æ¥æ”¶

ä½ æ”¶åˆ°çš„æ˜¯ï¼š

```
byte[] data
```

**ä¸è¦è½¬ Base64ï¼Œä¸è¦è½¬å­—ç¬¦ä¸²**

------

Step 1ï¸âƒ£ åŸºç¡€æ ¡éªŒï¼ˆå¿…é¡»ï¼‰

```
if data.length < 10 â†’ ç›´æ¥ä¸¢å¼ƒ
```

âš ï¸ æœ‰äº›æ˜¯å¿ƒè·³ ACKï¼Œæ•°æ®å¾ˆçŸ­

------

Step 2ï¸âƒ£ è§£æå¤–å±‚ protobufï¼ˆä¸è§£å‹ï¼‰

```
Response resp = Response.parseFrom(data)
```

âš ï¸ **æ­¤æ—¶åƒä¸‡ä¸è¦ gzip è§£å‹**

------

Step 3ï¸âƒ£ éå† messagesï¼ˆé‡è¦ï¼‰

```
for (Message msg : resp.messages)
```

âš ï¸ **ä¸€æ¬¡ onMessage é‡Œå¯èƒ½æœ‰å¤šæ¡**

------

Step 4ï¸âƒ£ åˆ¤æ–­ payload æ˜¯å¦å­˜åœ¨

```
if msg.payload == null or empty â†’ continue
```

| ç±»å‹   | payload |
| ------ | ------- |
| å¿ƒè·³   | âŒ       |
| ACK    | âŒ       |
| Chat   | âœ…       |
| Gift   | âœ…       |
| Member | âœ…       |

------

Step 5ï¸âƒ£ gzip è§£å‹ï¼ˆæ ¸å¿ƒï¼‰

**åˆ¤æ–­æ–¹å¼ï¼ˆæ¨èï¼‰**

- **ä¸æ˜¯ magic number**
- è€Œæ˜¯ **å¤–å±‚ header å·²ç»å‘Šè¯‰ä½  compress_type=gzip**

å¦‚æœä½ ä¸€å®šè¦å…œåº•ï¼š

```
payload[0] == 0x1F && payload[1] == 0x8B
```

------

Step 6ï¸âƒ£ è§£æå†…å±‚ protobufï¼ˆçœŸæ­£ä¸šåŠ¡ï¼‰

```
InnerMessage inner = InnerMessage.parseFrom(unzippedBytes)
```

------

Step 7ï¸âƒ£ æ ¹æ® method åˆ†å‘ï¼ˆæ ¸å¿ƒï¼‰

| method                      | å«ä¹‰      |
| --------------------------- | --------- |
| `WebcastChatMessage`        | å¼¹å¹•      |
| `WebcastGiftMessage`        | ç¤¼ç‰©      |
| `WebcastMemberMessage`      | è¿›åœº      |
| `WebcastLikeMessage`        | ç‚¹èµ      |
| `WebcastRoomUserSeqMessage` | åœ¨çº¿äººæ•°  |
| `WebcastControlMessage`     | å¼€æ’­/å…³æ’­ |

ğŸ“Œ **method å†³å®šä½ ç”¨å“ªä¸ª proto å»è§£**

------

#### 5.ä½ å¿…é¡»æå‰è§„é¿çš„ã€10 ä¸ªå¤§å‘ã€‘

##### âš ï¸ å‘ 1ï¼šä¸è¦å‡è®¾ä¸€å¸§ = ä¸€æ¡æ¶ˆæ¯

ğŸ‘‰ **æ°¸è¿œéå† messages[]**

------

##### âš ï¸ å‘ 2ï¼šä¸æ˜¯æ¯æ¡éƒ½æœ‰ payload

ğŸ‘‰ å¿ƒè·³ã€ACK å¾ˆå¤š

------

##### âš ï¸ å‘ 3ï¼šä¸è¦ç›´æ¥ gzip æ•´åŒ…5

ğŸ‘‰ gzip çš„æ˜¯ payloadï¼Œä¸æ˜¯ Response

------

##### âš ï¸ å‘ 4ï¼špayload è§£å‹åè¿˜æ˜¯ protobuf

ğŸ‘‰ ä¸æ˜¯ JSONã€ä¸æ˜¯æ–‡æœ¬

------

##### âš ï¸ å‘ 5ï¼šmethod å’Œ payload ç±»å‹ä¸ä¸€ä¸€å¯¹åº”5

ğŸ‘‰ Gift â‰  Chat çš„ proto

------

##### âš ï¸ å‘ 6ï¼šgift ä¸€æ¡é‡Œå¯èƒ½åŒ…å«å¤šæ¬¡è¿å‡»5

ğŸ‘‰ `repeat_count / combo_count`

------

##### âš ï¸ å‘ 7ï¼šè¿›åœº â‰  åœ¨çº¿äººæ•°5

ğŸ‘‰ Member æ˜¯äº‹ä»¶ï¼ŒUserSeq æ˜¯çŠ¶æ€

------

##### âš ï¸ å‘ 8ï¼šåŒä¸€ msgId å¯èƒ½é‡å‘

ğŸ‘‰ å»é‡å¾ˆé‡è¦ï¼ˆç¤¼ç‰©ï¼‰

------

##### âš ï¸ å‘ 9ï¼šcursor å¿…é¡»ç»´æŠ¤5

ğŸ‘‰ å¦åˆ™ä¼šæ–­æµæˆ–æ¼æ¶ˆæ¯

------

##### âš ï¸ ==å‘ 10ï¼šmethod å­—ç¬¦ä¸²ä¼šå˜==

ğŸ‘‰ ä¸è¦ç¡¬ç¼–ç  switchï¼Œåšæ˜ å°„è¡¨



æ ¸å¿ƒé—®é¢˜ï¼š

1ï¸âƒ£ **æŠŠ 6 ä¸ªæŒ‡æ ‡ â†” IM æ¶ˆæ¯å­—æ®µç²¾å‡†å¯¹åº”ï¼ˆå¯ç›´æ¥ç®—ï¼‰**

2ï¸âƒ£ **ç»™ä½ ä¸€ä»½ method â†’ proto å¯¹ç…§è¡¨**



### 3ã€é‡‡é›†ç¨‹åºæµç¨‹

[å¤©éœ¸åƒç´ ï¼ˆä¸‰è§’æ´²è¡ŒåŠ¨ï¼‰çš„æŠ–éŸ³ç›´æ’­é—´ - æŠ–éŸ³ç›´æ’­](https://live.douyin.com/200890247500?anchor_id=2487545507355961&follow_status=0&is_vs=0&vs_ep_group_id=&vs_episode_id=&vs_episode_stage=&vs_season_id=)

**==éœ€è¦ç™»é™†ï¼Œç™»é™†åè¾“å…¥æˆ¿é—´å·ï¼Œç›´æ¥è®¿é—®ç›´æ’­é—´ï¼Œä¸éœ€è¦è¿›è¡ŒäººæœºéªŒè¯==**

#### â‘  Java æ§åˆ¶å±‚å¯åŠ¨ä»»åŠ¡

**è§¦å‘ç‚¹**ï¼š

- æ¥å£è°ƒç”¨
- å®šæ—¶ä»»åŠ¡
- æ‰‹åŠ¨å¯åŠ¨

**åšçš„äº‹**ï¼š

1. åˆ›å»ºä¸€ä¸ªã€Œç›´æ’­ä»»åŠ¡ã€
2. åˆ†é…ï¼š
   - æµè§ˆå™¨å®ä¾‹ / tab
   - roomId
   - hook é…ç½®
3. å¯åŠ¨ Playwrightï¼ˆNode è¿›ç¨‹ï¼‰

ğŸ“Œ **æ­¤æ—¶ Java ä¸å…³å¿ƒ WSã€ä¸å…³å¿ƒæ•°æ®æ ¼å¼**

------

#### â‘¡ Playwright å¯åŠ¨ Edgeï¼ˆæµè§ˆå™¨å±‚ï¼‰

##### åšçš„äº‹æƒ…é¡ºåºï¼ˆéå¸¸é‡è¦ï¼‰ï¼š

1. å¯åŠ¨ Edgeï¼ˆheadless / headed å‡å¯ï¼‰
2. **æ³¨å†Œ route æ‹¦æˆª**
   - blockï¼š
     - video
     - image
     - font
     - cssï¼ˆå¯é€‰ï¼‰
3. æ‰“å¼€ç›´æ’­é—´ URL
4. **åœ¨ document-start æ³¨å…¥ Hook JS**

ğŸ“Œ **Hook ä¸€å®šè¦åœ¨é¡µé¢ JS åˆ›å»º WS ä¹‹å‰æ³¨å…¥**
å¦åˆ™ä½ ä¼šä¸¢ç¬¬ä¸€æ‰¹æ•°æ®ï¼ˆè¿›æˆ¿ / ackï¼‰

------

#### â‘¢ æŠ–éŸ³ç½‘é¡µåŸç”Ÿ JS å»ºç«‹ WebSocket

è¿™æ˜¯**æœ€å…³é”®çš„ç‚¹**ï¼š

- WebSocket æ˜¯ **é¡µé¢è‡ªå·±å»ºçš„**
- Cookie / localStorage / token éƒ½æ˜¯å¯¹çš„
- å¿ƒè·³ã€ACKã€cursor éƒ½æ˜¯å®˜æ–¹é€»è¾‘

ğŸ‘‰ ä½ å®Œå…¨ä¸å‚ä¸

------

#### â‘£ Hook JS æˆªè· onmessageï¼ˆæ ¸å¿ƒï¼‰

##### Hook åšäº†ä»€ä¹ˆï¼š

```
ws.onmessage = (event) => {
  // event.data === ArrayBuffer
}
```

1. æ‹·è´ `ArrayBuffer`
2. åˆ¤æ–­ï¼š
   - æ˜¯å¦æ˜¯æ§åˆ¶å¸§
   - æ˜¯å¦æ˜¯å¿ƒè·³
3. æ”¾å…¥ JS ç¼“å†²åŒºï¼ˆArrayï¼‰
4. å®šæ—¶ or æ»¡é‡ â†’ æ‰¹é‡å‘é€

ğŸ“Œ **å…³é”®ç‚¹**ï¼š

- ä¸è§£æ
- ä¸è§£å‹
- ä¸ proto decode

------

#### â‘¤ JS â†’ Java æ•°æ®è½¬å‘

ä½ è®¾è®¡å¾—éå¸¸å¯¹ ğŸ‘

##### ä¸¤ç§å¯è¡Œæ–¹å¼ï¼š

âœ… æ¨è 1ï¼šHTTP æ‰¹é‡ POST

- ç®€å•
- æ˜“é™æµ
- æ˜“é‡è¯•
- JVM å‹å¥½

âš ï¸ å¯é€‰ 2ï¼šWebSocket

- å»¶è¿Ÿä½
- å®ç°å¤æ‚
- å¿ƒè·³è¦è‡ªå·±ç®¡

ğŸ“Œ **å¼ºçƒˆå»ºè®®ï¼š**

> **JS èšåˆ + HTTP POSTï¼ˆäºŒè¿›åˆ¶æˆ– base64ï¼‰**

------

#### â‘¥ Java æ•°æ®æ¥æ”¶ & è§£ç å±‚

##### åœ¨è¿™é‡Œä½ ç»ˆäºå¼€å§‹â€œæ‡‚æ•°æ®â€äº†

å¤„ç†é¡ºåºåº”è¯¥æ˜¯ï¼š

1. æ¥æ”¶å­—èŠ‚æ•°ç»„
2. åˆ¤æ–­å‹ç¼©ç±»å‹
   - gzip
   - brotliï¼ˆå°‘é‡ï¼‰
3. è§£å‹
4. Protobuf decode
5. æ‹† Response â†’ Message

ğŸ“Œ è¿™é‡Œæ˜¯ä½ **å”¯ä¸€**å¤„ç†åè®®çš„åœ°æ–¹
å¾ˆå¥½ç»´æŠ¤ã€å¾ˆå¥½è°ƒè¯•

------

#### â‘¦ æ¶ˆæ¯åˆ†å‘å±‚ï¼ˆä¸šåŠ¡å…¥å£ï¼‰

##### æ ‡å‡†åšæ³•ï¼š

- æ ¹æ® `method` / `msgType`
- åˆ†å‘åˆ°ï¼š
  - DanmuHandler
  - GiftHandler
  - LikeHandler
  - EnterRoomHandler

ğŸ“Œ **å¼‚æ­¥å¤„ç†ï¼Œæ°¸è¿œä¸è¦é˜»å¡è§£æçº¿ç¨‹**

### 4ã€Hook æµè§ˆå™¨ WebSocket

####  1. Hook JS ç›‘å¬ WebSocket

**100% å¯è¡Œï¼Œè€Œä¸”å·²ç»è¢«å¤§é‡å®æˆ˜éªŒè¯**

å¸¸è§ Hook ç‚¹åŒ…æ‹¬ï¼š

- `WebSocket.prototype.send`
- `WebSocket.prototype.onmessage`
- `addEventListener("message")`

ä½ è¯´çš„ï¼š

> æ¯å½“æœåŠ¡å™¨æ¨é€ä¸€æ¡æ•°æ®ï¼Œæ‹·è´ä¸€ä»½

âœ” **è¿™æ˜¯å…³é”®ç‚¹ï¼šæ‹·è´ï¼Œä¸å¹²æ‰°åŸé€»è¾‘**

------

#### ğŸ”¹ 2. åŸç”Ÿé¡µé¢å»ºç«‹ WSï¼ˆè¿™æ˜¯æœ€å¤§ä¼˜åŠ¿ï¼‰

è¿™ä¸€ç‚¹ **ç›´æ¥ç§’æ€ Java ç›´è¿æ–¹æ¡ˆ**

å› ä¸ºï¼š

- æ‰€æœ‰å‚æ•°ï¼šâœ…
- æ‰€æœ‰ Cookieï¼šâœ…
- æ‰€æœ‰é£æ§ï¼šâœ…
- æ‰€æœ‰ JS é€»è¾‘ï¼šâœ…

ğŸ‘‰ **ä½ ä¸å†â€œæ¨¡æ‹Ÿæµè§ˆå™¨â€ï¼Œä½ å°±æ˜¯æµè§ˆå™¨**

------

#### ğŸ”¹ 3. JS â†’ Java æ¨é€æ•°æ®

è¿™é‡Œä½ ç”¨ï¼š

- `window.onmessageReceived`
- æˆ– `fetch / WebSocket / HTTP POST`

éƒ½æ˜¯åˆç†çš„

âš  æ³¨æ„ç‚¹ï¼ˆåé¢ä¼šè¯´å‘ï¼‰

------

#### ğŸ”¹ 4. æµè§ˆå™¨å®ä¾‹å¼€é”€å¤§ï¼Ÿ

ä½ è¿™ä¸ªåˆ¤æ–­**éå¸¸æ¸…é†’**ã€‚

ä½†ä½ åé¢è¯´çš„ä¼˜åŒ–æ–¹æ¡ˆæ˜¯å¯¹çš„ï¼š

#### å¯è¡Œä¼˜åŒ–ç‚¹

- æ‹¦æˆªè§†é¢‘æµï¼ˆ`*.m3u8` / `*.mp4`ï¼‰
- æ‹¦æˆªå›¾ç‰‡ / css / font
- headless æ¨¡å¼
- ç¦ç”¨éŸ³é¢‘
- é™åˆ¶å¸§ç‡
- å• tab å¤šæˆ¿é—´ï¼ˆé«˜çº§ï¼‰

ğŸ‘‰ **å†…å­˜å’Œ CPU å¯ä»¥å‹åˆ°å¯æ§èŒƒå›´**

------

#### ğŸ”¹ 5. é«˜å¹¶å‘å¼¹å¹•èšåˆ

è¿™ä¸ªè®¾è®¡æ€è·¯ **éå¸¸æ­£ç¡®**

- JS ç«¯ç¼“å­˜
- æ‰¹é‡å‘é€
- å‡å°‘ Java æ¥å£ QPS

ğŸ‘ å·¥ç¨‹ä¸Šå®Œå…¨åˆç†